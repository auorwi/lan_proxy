# 🌐 局域网代理工具 (LAN Proxy)

一个简单易用的局域网代理转发工具，让局域网内的其他设备通过本机的 VPN 代理上网。

## ✨ 功能特点

- **简单配置**: 通过 YAML 文件配置，灵活易用
- **无需认证**: 局域网设备连接无需账号密码
- **HTTP/HTTPS 支持**: 完整支持 HTTP 和 HTTPS (CONNECT) 请求
- **启动检测**: 自动检测上游代理是否可用
- **IP 显示**: 启动时显示所有局域网 IP 地址
- **日志记录**: 可配置的请求日志

## 📋 系统要求

- Python 3.7+
- PyYAML

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 修改配置

编辑 `config.yaml` 文件：

```yaml
# 本地代理服务器配置
server:
  port: 8080          # 局域网设备连接的端口
  host: "0.0.0.0"     # 监听所有网卡

# 上游代理配置 (你的 VPN 代理)
upstream:
  host: "127.0.0.1"   # VPN 代理地址
  port: 15236         # VPN 代理端口
  type: "http"        # 代理类型
```

### 3. 启动服务

```bash
python proxy_server.py
```

### 4. 配置其他设备

服务启动后会显示局域网 IP 地址，在其他设备上配置：

- **代理服务器**: 显示的局域网 IP (如 192.168.1.100)
- **代理端口**: 8080 (或你配置的端口)
- **代理类型**: HTTP
- **认证**: 无

## ⚙️ 配置说明

### 完整配置示例

```yaml
# 本地代理服务器配置
server:
  port: 8080
  host: "0.0.0.0"

# 上游代理配置 (VPN 代理)
upstream:
  host: "127.0.0.1"
  port: 15236
  type: "http"

# 日志配置
logging:
  level: "INFO"           # DEBUG, INFO, WARNING, ERROR
  show_requests: true     # 是否显示请求日志

# 健康检查配置
health_check:
  test_url: "https://www.google.com"
  timeout: 10
```

### 配置项说明

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `server.port` | 代理服务监听端口 | 8080 |
| `server.host` | 监听地址，0.0.0.0 表示所有接口 | 0.0.0.0 |
| `upstream.host` | 上游代理地址 | 127.0.0.1 |
| `upstream.port` | 上游代理端口 | 15236 |
| `upstream.type` | 代理类型 | http |
| `logging.level` | 日志级别 | INFO |
| `logging.show_requests` | 是否显示请求 | true |
| `health_check.test_url` | 健康检查 URL | https://www.google.com |
| `health_check.timeout` | 超时时间(秒) | 10 |

## 📱 客户端配置

### iOS / iPadOS

1. 设置 → Wi-Fi → 点击已连接的 Wi-Fi 名称
2. 滚动到底部，点击"配置代理"
3. 选择"手动"
4. 填入代理服务器 IP 和端口

### Android

1. 设置 → Wi-Fi → 长按已连接的网络
2. 选择"修改网络" → 显示高级选项
3. 代理选择"手动"
4. 填入代理服务器 IP 和端口

### Windows

1. 设置 → 网络和 Internet → 代理
2. 手动设置代理，开启
3. 填入代理服务器 IP 和端口

### macOS

1. 系统偏好设置 → 网络 → 选择网络 → 高级
2. 代理 → 勾选 "Web 代理 (HTTP)" 和 "安全 Web 代理 (HTTPS)"
3. 填入代理服务器 IP 和端口

### Chrome 浏览器

可以使用 SwitchyOmega 等代理插件配置。

## 🔧 故障排除

### 上游代理不可用

```
❌ 上游代理端口 127.0.0.1:15236 未开放或无法连接
```

**解决方法**:
1. 确保 VPN 工具已启动
2. 检查 VPN 代理端口是否正确
3. 确认 VPN 使用的是 HTTP 代理

### 端口被占用

```
❌ 错误: 无法绑定端口 8080
```

**解决方法**:
1. 修改 `config.yaml` 中的端口
2. 或关闭占用端口的程序

### 无法访问外网

1. 先在本机测试 VPN 代理是否正常
2. 检查防火墙是否允许 8080 端口
3. 确保设备在同一局域网

## 📝 日志示例

```
╔══════════════════════════════════════════════════════════════════╗
║                    🌐 局域网代理服务器                              ║
║                    LAN Proxy Server                              ║
╚══════════════════════════════════════════════════════════════════╝

📋 配置信息:
   • 监听端口: 8080
   • 上游代理: 127.0.0.1:15236
   • 代理类型: HTTP

🖥️  局域网 IP 地址:
   • http://192.168.1.100:8080

📱 其他设备代理设置:
   • 代理服务器: 192.168.1.100
   • 代理端口: 8080
   • 代理类型: HTTP
   • 认证: 无需认证

🔍 正在检查上游代理...
✅ 上游代理正常，成功访问 https://www.google.com

08:30:15 | INFO    | 🚀 代理服务器已启动，监听 0.0.0.0:8080
08:30:15 | INFO    | 按 Ctrl+C 停止服务器

08:30:20 | INFO    | [192.168.1.50] CONNECT www.google.com:443
08:30:21 | INFO    | [192.168.1.50] GET www.youtube.com:80
```

## ⚠️ 注意事项

1. 本工具仅供局域网内设备使用，不建议暴露到公网
2. 确保您有合法使用 VPN 的权限
3. 请遵守当地法律法规

## 📄 许可证

MIT License
